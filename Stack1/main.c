/*
 * Stack1
 *
 *
 */

#include <stdio.h>
#include <stdlib.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <libgen.h>
#include <unistd.h>

int fd;
struct stat st;

int main(int argc, char *argv[]){

	unsigned char buf[8];
	uint password = 0;

	if(argc < 2){
		printf("usage: %s <inputFile> \n\n", basename(argv[0]));
		exit(-1);
	}

	fd = open(argv[1], O_RDONLY);
	if(fd < 0){
		printf("Error opening the input file \n\n");
		exit(-1);
	}

	stat(argv[1], &st);
	if(st.st_size < 2){
		printf("Wrong file size \n\n");
		exit(-1);
	}

	//Reading the password
	read(fd, buf, 2);
	password = buf[0] + buf[1];
	password = password * 2; //will always be even HAHAHA

	//Reading the rest of the file
	read(fd, buf, st.st_size - 2);

	//Checking the magic bytes
	if(buf[0] != 0x66 || buf[1] != 0x66){
		printf("Bad Magic Bytes\n");
		exit(-1);
	}

	if(password == 0x6663){ //an odd number HAHAHA

		int result = system("gnome-calculator");

	}else{

		printf("Bad luck HAHAHA\n");
	}

	printf("That's All Folks\n");
}
